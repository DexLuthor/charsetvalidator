<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Charset Validator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
  <style>
      * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
      }

      body {
          font-family: 'Arial', sans-serif;
          height: 100dvh;
          width: 100%;
          background-color: #f4f4f4;
          color: #333;
          transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
          position: relative;
      }

      .dark-mode {
          background-color: #1e1e1e;
          color: #f4f4f4;
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
      }

      .header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
      }

      .title {
          font-size: 24px;
          font-weight: bold;
      }

      .controls {
          display: flex;
          gap: 15px;
          align-items: center;
      }

      .textarea-container {
          margin-bottom: 20px;
      }

      .textarea {
          width: 100%;
          height: 300px;
          padding: 15px;
          resize: none;
          border: 2px solid #ccc;
          border-radius: 8px;
          background-color: white;
          color: #333;
          transition: all 0.3s ease-in-out;
          font-size: 16px;
          outline: none;
          font-family: monospace;
      }

      .dark-mode .textarea {
          background-color: #333;
          color: white;
          border: 2px solid #555;
      }

      textarea.valid {
          border: 2px solid #4CAF50;
          box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
      }

      textarea.invalid {
          border: 2px solid #f44336;
          box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
      }

      .stats {
          display: flex;
          gap: 20px;
          margin-bottom: 20px;
          font-size: 14px;
          color: #666;
      }

      .dark-mode .stats {
          color: #aaa;
      }

      .results {
          background-color: white;
          border-radius: 8px;
          padding: 20px;
          margin-top: 20px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .dark-mode .results {
          background-color: #2d2d2d;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .results-title {
          font-size: 18px;
          font-weight: bold;
          margin-bottom: 15px;
      }

      .invalid-chars {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
      }

      .char-card {
          background-color: #f8f9fa;
          border-radius: 6px;
          padding: 10px;
          display: flex;
          flex-direction: column;
          align-items: center;
          min-width: 80px;
      }

      .dark-mode .char-card {
          background-color: #3d3d3d;
      }

      .char-display {
          font-size: 24px;
          margin-bottom: 5px;
          font-family: monospace;
      }

      .char-code {
          font-size: 12px;
          color: #666;
      }

      .dark-mode .char-code {
          color: #aaa;
      }

      .invisible-char {
          border: 1px dotted rgba(216, 65, 65, 0.7);
          padding: 2px;
      }

      select, button {
          padding: 10px 15px;
          border-radius: 8px;
          border: 2px solid #ccc;
          background-color: white;
          color: #333;
          transition: all 0.3s ease-in-out;
          font-size: 14px;
      }

      .dark-mode select, .dark-mode button {
          background-color: #333;
          color: white;
          border: 2px solid #555;
      }

      button {
          cursor: pointer;
          background-color: #007BFF;
          color: white;
          border: none;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .dark-mode button {
          background-color: #0056b3;
      }

      button:hover {
          background-color: #0056b3;
      }

      .dark-mode button:hover {
          background-color: #003f7f;
      }

      .toggle-dark-mode {
          padding: 10px;
          border-radius: 50%;
          background-color: #007BFF;
          color: white;
          border: none;
          transition: background-color 0.3s ease-in-out;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 16px;
      }

      .dark-mode .toggle-dark-mode {
          background-color: #0056b3;
      }

      .toggle-dark-mode:hover {
          background-color: #0056b3;
      }

      .dark-mode .toggle-dark-mode:hover {
          background-color: #003f7f;
      }

      .validation-status {
          padding: 10px 15px;
          border-radius: 8px;
          font-weight: bold;
      }

      .status-valid {
          background-color: #4CAF50;
          color: white;
      }

      .status-invalid {
          background-color: #f44336;
          color: white;
      }
  </style>
</head>
<body class="dark-mode">
<div class="container">
    <div class="header">
        <div class="title">Charset Validator</div>
        <div class="controls">
            <select id="charsetSelect" name="charsetSelect">
                <option value="ascii">ASCII</option>
                <option value="latin1">Latin-1</option>
                <option value="utf8mb4">UTF-8 (mb4)</option>
            </select>
            <button class="submit" onclick="runValidation()">
                <i class="fas fa-check"></i> Validate
            </button>
            <button class="toggle-dark-mode" onclick="toggleDarkMode()">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>

    <div class="textarea-container">
        <textarea class="textarea" id="textInput" name="textInput" onchange="changeText()" placeholder="Enter text to validate..."></textarea>
    </div>

    <div class="stats">
        <div>Characters: <span id="charCount">0</span></div>
        <div>Status: <span id="validationStatus" class="validation-status">Not validated</span></div>
    </div>

    <div class="results" id="results" style="display: none;">
        <div class="results-title">Invalid Characters Found</div>
        <div class="invalid-chars" id="invalidChars"></div>
    </div>
</div>

<script>
    function isInvisible(char) {
        const invisibleCharPattern = /[\x00-\x1F\x7F\s\u200B\u200C\u200D\u200E\u200F\u202A-\u202E\u2060\uFEFF\u00A0\u202F]/;
        return invisibleCharPattern.test(char);
    }

    function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
    }

    function updateCharCount() {
        const textInput = document.getElementById("textInput");
        document.getElementById("charCount").textContent = textInput.value.length;
    }

    function changeText() {
        const textInput = document.getElementById("textInput");
        textInput.classList.remove("valid");
        textInput.classList.remove("invalid");
        document.getElementById("validationStatus").textContent = "Not validated";
        document.getElementById("validationStatus").className = "validation-status";
        document.getElementById("results").style.display = "none";
        updateCharCount();
    }

    function runValidation() {
        const textInput = document.getElementById("textInput");
        const charsetSelect = document.getElementById("charsetSelect");
        const validationStatus = document.getElementById("validationStatus");
        const results = document.getElementById("results");
        const invalidChars = document.getElementById("invalidChars");

        const text = textInput.value;
        const charset = charsetSelect.value;

        const charsetRanges = {
            ascii: /^[\x00-\x7F]+$/,
            latin1: /^[\x00-\xFF]+$/,
            utf8mb4: (text) => {
                try {
                    new TextEncoder().encode(text);
                    return true;
                } catch {
                    return false;
                }
            }
        };

        function validateAgainstCharset(text, charset) {
            const validation = charsetRanges[charset];

            if (typeof validation === "function") {
                return validation(text) ? [] : [...text];
            }
            return [...text]
                .filter(char => !validation.test(char))
                .map(char => ({
                    char: char,
                    code: char.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0')
                }));
        }

        if (charset in charsetRanges) {
            const result = validateAgainstCharset(text, charset);
            if (result.length > 0) {
                textInput.classList.remove("valid");
                textInput.classList.add("invalid");
                validationStatus.textContent = "Invalid";
                validationStatus.className = "validation-status status-invalid";
                results.style.display = "block";

                invalidChars.innerHTML = result.map(({char, code}) => `
                    <div class="char-card">
                        <div class="char-display">${isInvisible(char) ? `<span class="invisible-char">${char}</span>` : char}</div>
                        <div class="char-code">U+${code}</div>
                    </div>
                `).join('');
            } else {
                textInput.classList.add("valid");
                textInput.classList.remove("invalid");
                validationStatus.textContent = "Valid";
                validationStatus.className = "validation-status status-valid";
                results.style.display = "none";
            }
        } else {
            console.log("Warning: Charset validation not supported for", charset);
        }
    }

    // Initialize character count
    document.getElementById("textInput").addEventListener("input", updateCharCount);
</script>
</body>
</html>
